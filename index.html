<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Mini Game</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      font-family: 'Arial', sans-serif;
    }
    .game-container {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 150px);
      grid-template-rows: repeat(3, 200px);
      gap: 20px;
      perspective: 1000px;
    }
    @media (max-width: 768px) {
      .grid { grid-template-columns: repeat(3, 100px); grid-template-rows: repeat(3, 140px); gap: 12px; }
    }
    @media (max-width: 480px) {
      .grid { grid-template-columns: repeat(3, 85px); grid-template-rows: repeat(3, 120px); gap: 10px; }
    }
    .card {
      position: relative;
      width: 150px;
      height: 200px;
      cursor: pointer;
      transform-style: preserve-3d;
      transition: transform 0.6s;
      pointer-events: none;
    }
    @media (max-width: 768px) { .card { width: 100px; height: 140px; } }
    @media (max-width: 480px) { .card { width: 85px; height: 120px; } }
    .card.clickable { pointer-events: all; }
    .card.flipped { transform: rotateY(180deg); }
    .card.scrambling { transition: all 0.3s ease-in-out; }
    .card-face {
      position: absolute;
      width: 100%; height: 100%;
      backface-visibility: hidden;
      border-radius: 15px;
      display: flex; justify-content: center; align-items: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      pointer-events: none; user-select: none;
    }
    .card-front { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card-back { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); transform: rotateY(180deg); }
    .card-icon { font-size: 60px; filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3)); }
    @media (max-width: 768px) { .card-icon { font-size: 45px; } }
    @media (max-width: 480px) { .card-icon { font-size: 35px; } }
    .card-pattern {
      width: 80%; height: 80%;
      background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);
      border-radius: 10px;
    }
    .start-btn {
      position: fixed;
      bottom: 30px; left: 50%; transform: translateX(-50%);
      padding: 15px 40px; font-size: 24px; font-weight: bold;
      color: #fff; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none; border-radius: 50px; cursor: pointer;
      box-shadow: 0 4px 15px rgba(102,126,234,0.4);
      transition: transform 0.2s, box-shadow 0.2s;
      z-index: 300;
    }
    @media (max-width: 768px) { .start-btn { bottom: 20px; padding: 12px 35px; font-size: 20px; } }
    @media (max-width: 480px) { .start-btn { bottom: 15px; padding: 10px 30px; font-size: 18px; } }
    .start-btn:hover { transform: translateX(-50%) scale(1.05); box-shadow: 0 6px 20px rgba(102,126,234,0.6); }
    .start-btn:active { transform: translateX(-50%) scale(0.95); }
    .prompt {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95); padding: 30px 50px;
      border-radius: 20px; font-size: 28px; font-weight: bold; color: #333;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 100;
    }
    @media (max-width: 768px) { .prompt { padding: 25px 40px; font-size: 24px; } }
    @media (max-width: 480px) { .prompt { padding: 20px 30px; font-size: 20px; } }
    .prompt.show { opacity: 1; }
    .overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.95);
      display: flex; justify-content: center; align-items: center;
      opacity: 0; pointer-events: none; transition: opacity 0.5s; z-index: 200;
    }
    .overlay.show { opacity: 1; pointer-events: all; }
    .result-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      width: 300px; height: 400px; border-radius: 25px;
      display: flex; justify-content: center; align-items: center;
      box-shadow: 0 20px 60px rgba(102,126,234,0.6);
      transform: scale(0.5); transition: transform 0.5s;
    }
    @media (max-width: 768px) { .result-card { width: 250px; height: 350px; } }
    @media (max-width: 480px) { .result-card { width: 200px; height: 280px; } }
    .overlay.show .result-card { transform: scale(1); }
    .result-icon { font-size: 150px; filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.5)); }
    @media (max-width: 768px) { .result-icon { font-size: 120px; } }
    @media (max-width: 480px) { .result-icon { font-size: 90px; } }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="grid" id="grid"></div>
    <button class="start-btn" id="startBtn">START</button>
    <div class="prompt" id="prompt">Pick a Card!</div>
  </div>
  <div class="overlay" id="overlay">
    <div class="result-card">
      <div class="result-icon" id="resultIcon"></div>
    </div>
  </div>

  <script>
    const icons = ['ðŸ’Ž', 'ðŸ‘‘', 'â­', 'ðŸŽ', 'ðŸ†', 'ðŸ’°', 'ðŸŽ¯', 'ðŸ”¥', 'âš¡'];
    const allowedIcons = ['ðŸŽ', 'ðŸ”¥', 'âš¡']; 
    let gameStarted = false;
    let canClick = false;
    let cardData = [];

    const grid = document.getElementById('grid');
    const startBtn = document.getElementById('startBtn');
    const prompt = document.getElementById('prompt');
    const overlay = document.getElementById('overlay');
    const resultIcon = document.getElementById('resultIcon');

    function initCards() {
      grid.innerHTML = '';
      cardData = icons.map((icon, index) => ({
        icon: icon,
        position: index
      }));
      cardData.forEach((data, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.index = index;
        card.innerHTML = `
          <div class="card-face card-front">
            <div class="card-icon">${data.icon}</div>
          </div>
          <div class="card-face card-back">
            <div class="card-pattern"></div>
          </div>
        `;
        card.addEventListener('click', () => handleCardClick(index));
        grid.appendChild(card);
      });
    }

    startBtn.addEventListener('click', () => {
      if (gameStarted) return;
      gameStarted = true;
      startBtn.classList.add('hidden');
      setTimeout(() => {
        const cards = document.querySelectorAll('.card');
        cards.forEach(card => card.classList.add('flipped'));
        setTimeout(() => scrambleCards(), 700);
      }, 500);
    });

    function scrambleCards() {
      const cards = document.querySelectorAll('.card');
      const positions = Array.from({length: 9}, (_, i) => i);
      for (let i = positions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [positions[i], positions[j]] = [positions[j], positions[i]];
      }
      cards.forEach((card, index) => {
        card.classList.add('scrambling');
        const newPos = positions[index];
        const row = Math.floor(newPos / 3);
        const col = newPos % 3;
        card.style.transform = `translate(${(col - (index % 3)) * 170}px, ${(row - Math.floor(index / 3)) * 220}px) rotateY(180deg)`;
      });
      let shuffleCount = 0;
      const shuffleInterval = setInterval(() => {
        cards.forEach((card, index) => {
          const newPos = Math.floor(Math.random() * 9);
          const row = Math.floor(newPos / 3);
          const col = newPos % 3;
          const originalRow = Math.floor(index / 3);
          const originalCol = index % 3;
          const cardWidth = window.innerWidth <= 480 ? 85 : (window.innerWidth <= 768 ? 100 : 150);
          const cardHeight = window.innerWidth <= 480 ? 120 : (window.innerWidth <= 768 ? 140 : 200);
          const gap = window.innerWidth <= 480 ? 10 : (window.innerWidth <= 768 ? 12 : 20);
          const spacing = cardWidth + gap;
          const verticalSpacing = cardHeight + gap;
          card.style.transform = `translate(${(col - originalCol) * spacing}px, ${(row - originalRow) * verticalSpacing}px) rotateY(180deg)`;
        });
        shuffleCount++;
        if (shuffleCount >= 8) {
          clearInterval(shuffleInterval);
          finalizePositions(positions);
        }
      }, 150);
    }

    function finalizePositions(positions) {
      const cards = document.querySelectorAll('.card');
      const tempData = [...cardData];
      const newCardData = [];
      cards.forEach((card, oldIndex) => {
        const newPos = positions[oldIndex];
        newCardData[newPos] = tempData[oldIndex];
      });
      cardData = newCardData;
      setTimeout(() => {
        cards.forEach(card => {
          card.style.transform = '';
          card.classList.remove('scrambling');
        });
        setTimeout(() => {
          grid.innerHTML = '';
          cardData.forEach((data, index) => {
            const card = document.createElement('div');
            card.className = 'card flipped';
            card.dataset.index = index;
            card.innerHTML = `
              <div class="card-face card-front">
                <div class="card-icon">${data.icon}</div>
              </div>
              <div class="card-face card-back">
                <div class="card-pattern"></div>
              </div>
            `;
            card.addEventListener('click', () => handleCardClick(index));
            grid.appendChild(card);
          });
          setTimeout(() => {
            prompt.classList.add('show');
            setTimeout(() => {
              prompt.classList.remove('show');
              canClick = true;
              const allCards = document.querySelectorAll('.card');
              allCards.forEach(card => card.classList.add('clickable'));
            }, 1000);
          }, 300);
        }, 300);
      }, 300);
    }

    // --- Only allowed icons appear when revealing ---
    function handleCardClick(index) {
      if (!canClick) return;
      canClick = false;
      prompt.classList.remove('show');
      const cards = document.querySelectorAll('.card');
      const clickedCard = cards[index];
      
      // Pick only from allowed set
      const result = allowedIcons[Math.floor(Math.random() * allowedIcons.length)];

      // Replace card front with the result icon
      const frontFace = clickedCard.querySelector('.card-front .card-icon');
      if (frontFace) {
        frontFace.textContent = result;
      }

      // Flip to reveal
      clickedCard.classList.remove('flipped');

      // Show overlay with same result
      setTimeout(() => {
        resultIcon.textContent = result;
        overlay.classList.add('show');
      }, 1000);
    }

    initCards();
  </script>
</body>
</html>
